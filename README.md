# Notion Webhook Server

ChatGPTからNotionデータベースへの自動投稿を行うWebhookサーバー

## セットアップ手順

### 1. Notion APIの設定

1. Notionインテグレーションの作成
   - [Notion Developers](https://www.notion.so/my-integrations) にアクセス
   - 「新しいインテグレーション」をクリック
   - 名前を設定（例：`ChatGPT Webhook Bot`）
   - 必要な機能を選択：
     - コンテンツの読み取り
     - コンテンツの更新
     - コンテンツの挿入
     - コメントの読み取り
     - コメントの挿入
   - インテグレーションシークレット（`NOTION_TOKEN`）をコピーして保存

2. データベースの作成と設定
   - Notionで新規データベースを作成
   - 必要なプロパティを設定：
     - 名前（タイトル型）
     - Status（ステータス型）
     - テキスト（リッチテキスト型）
     - URL（URL型）
     - 日付（日付型）

3. **重要**: データベースIDの取得
   - データベースビューを開く
   - 右上の「...」（その他のオプション）をクリック
   - 「ビューのリンクをコピー」を選択
   - コピーされたURLから32文字の英数字（データベースID）を抽出
   - ⚠️ 注意: ブラウザのURLバーから直接コピーしたIDは使用できません

4. データベースとインテグレーションの接続
   - データベースページで右上の「...」をクリック
   - 「接続」を選択
   - 作成したインテグレーションを追加

### 2. 環境設定

1. 必要なパッケージのインストール
   ```bash
   pip install -r requirements.txt
   ```

2. 環境変数の設定
   - `.env`ファイルを作成
   ```env
   NOTION_TOKEN=your_integration_secret
   NOTION_DATABASE_ID=your_database_id
   PORT=10000  # オプション：デフォルトは10000
   ```

### 3. サーバーの起動

```bash
python main.py
```

## 使用方法

1. Webhookエンドポイント
   - URL: `http://your-server:10000/webhook`
   - メソッド: POST
   - Content-Type: application/json

2. リクエスト形式
   ```json
   {
     "message": "投稿したい内容"
   }
   ```

3. レスポンス形式
   ```json
   {
     "status": "success",
     "notion_status": 200,
     "notion_response": "..."
   }
   ```

## トラブルシューティング

1. 404エラー（データベースが見つからない）
   - データベースIDの取得方法を確認
   - 必ず「ビューのリンクをコピー」から取得したIDを使用
   - ブラウザのURLバーのIDは使用不可

2. 認証エラー
   - インテグレーションシークレットの確認
   - データベースとインテグレーションの接続確認

3. バリデーションエラー
   - プロパティ名の確認（"Title"ではなく"名前"を使用）
   - 必須フィールドが正しく設定されているか確認

## 開発者向け情報

- APIバージョン: 2022-06-28
- データベースIDの形式: 32文字の英数字（ハイフンは自動的に追加されます）
- ステータスコード200以外の場合は、詳細なエラー情報がログに出力されます
